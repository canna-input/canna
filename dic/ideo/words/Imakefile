/* $Id: Imakefile,v 1.9 2008/04/05 17:25:46 aida_s Exp $ */
#include "../../../Canna.conf"

#ifdef __EMX__
            CANNAROOT = ..\\..\\..
          CANNACMDDIR = $(CANNAROOT)\\cmd
               CRXDIC = $(CANNACMDDIR)\\crxdic\\crxdic
               CRFREQ = $(CANNACMDDIR)\\crfreq\\crfreq
#else
            CANNAROOT = ../../..
          CANNACMDDIR = $(CANNAROOT)/cmd
               CRXDIC = $(CANNACMDDIR)/crxdic/crxdic
               CRFREQ = $(CANNACMDDIR)/crfreq/crfreq
#endif
          CANNADICDIR = $(DicDir)/canna
            SAMPLEDIR = $(CANNADIR)/sample
         SAMPLESRCDIR = $(CANNADIR)/sample/src

#ifdef USE_OBSOLETE_STYLE_FILENAME
                  CBD = d
                  CLD = fq
#else
                  CBD = cbd
                  CLD = cld
#endif
          FUZOKUGODIC = ../grammar/cnj.bits
#ifdef DIC_3_6_COMPAT
           COMPATFLAG = -c 3.0
#endif

#define MakeBinDic(name,src,crfreqarg) \
	$(CRXDIC) $(COMPATFLAG) -D $(FUZOKUGODIC) -m -o name.$(CBD) -n name src @@\
	$(CRFREQ) crfreqarg -o name.$(CLD) name.$(CBD) name.mwd

#define MasterBinDicTarget(name,src,crfreqarg,slaves)			@@\
AllTarget(name.$(CBD) name.$(CLD))					@@\
name.$(CBD) name.$(CLD): src $(FUZOKUGODIC) slaves			@@\
	MakeBinDic(name,src,crfreqarg)					@@\
	cat slaves >> name.$(CBD)					@@\
clean::									@@\
	$(RM) name.$(CBD) name.$(CLD)					@@\
InstallMultipleFlags(name.$(CBD) name.$(CLD),$(CANNADICDIR),-m 644 $(cannaOwnerGroup))

#define SlaveBinDicTarget(name,src,crfreqarg)				@@\
AllTarget(name.$(CLD))							@@\
name.$(CBD) name.$(CLD): src $(FUZOKUGODIC)				@@\
	MakeBinDic(name,src,crfreqarg)					@@\
clean::									@@\
	$(RM) name.$(CBD) name.$(CLD)					@@\
InstallMultipleFlags(name.$(CLD),$(CANNADICDIR),-m 644 $(cannaOwnerGroup))

MasterBinDicTarget(iroha,$(pubdicDir)/iroha.t,-div 512,bushu.$(CBD))
SlaveBinDicTarget(bushu,bushu.t,)
MasterBinDicTarget(zipcode,zipcode.t,,jigyosyo.$(CBD))
SlaveBinDicTarget(jigyosyo,jigyosyo.t,)

MakeDirectories(install,$(CANNADICDIR))

#ifdef USE_OBSOLETE_STYLE_FILENAME
InstallNamedNonExec(obsolete.dir,dics.dir,$(CANNADICDIR))
#else
InstallNonExec(dics.dir,$(CANNADICDIR))
#endif

install::
	$(CHGRP) $(cannaGroup) $(DESTDIR)$(CANNADICDIR)
	$(CHOWN) $(cannaOwner) $(DESTDIR)$(CANNADICDIR)
	$(CHMOD) ug+w $(DESTDIR)$(CANNADICDIR)
	$(CHGRP) $(cannaGroup) $(DESTDIR)$(DicDir)
	$(CHOWN) $(cannaOwner) $(DESTDIR)$(DicDir)
	$(CHMOD) ug+w $(DESTDIR)$(DicDir)
	$(CHMOD) -w $(DESTDIR)$(CANNADICDIR)/dics.dir

#ifndef USE_OBSOLETE_STYLE_FILENAME
InstallNamedNonExec(necgaiji.t,necgaiji.ctd,$(CANNADICDIR))
InstallNamedNonExec(kanasmpl.t,kanasmpl.ctd,$(CANNADICDIR))
InstallNamedNonExec(software.t,software.ctd,$(CANNADICDIR))
InstallNamedNonExec(chimei.t,chimei.ctd,$(CANNADICDIR))
InstallNamedNonExec(hojomwd.t,hojomwd.ctd,$(CANNADICDIR))
InstallNamedNonExec(hojoswd.t,hojoswd.ctd,$(CANNADICDIR))
InstallNamedNonExec(suffix.t,suffix.ctd,$(CANNADICDIR))
InstallNamedNonExec(number.t,number.ctd,$(CANNADICDIR))
InstallNamedNonExec(katakana.t,katakana.ctd,$(CANNADICDIR))
InstallNamedNonExec(keishiki.t,keishiki.ctd,$(CANNADICDIR))

install::
	cd $(DESTDIR)$(CANNADICDIR) ; $(CHMOD) 0664 *.ctd ;\
	$(CHOWN) $(cannaOwner) *.ctd ; $(CHGRP) $(cannaGroup) *.ctd
#else
    TEXTDICS = necgaiji.t kanasmpl.t software.t chimei.t \
               hojomwd.t hojoswd.t suffix.t number.t katakana.t keishiki.t
InstallMultipleFlags($(TEXTDICS),$(CANNADICDIR),-m 0664 $(cannaOwnerGroup))
#endif

depend::
